<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Exploring software technologies">

    <title>On-The-Fly C++ - Coldflake Blog</title>

    <link rel="canonical" href="http://blog.coldflake.com/posts/On-the-fly-C++">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/coldflake.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Bitter:400,700,400italic|Ubuntu:400,500,700" rel="stylesheet" type="text/css">

    <!-- iconfonts -->
    <style type="text/css" media="screen, print">
        @font-face {
          font-family: 'icomoon';
          src:url('/fonts/icomoon.eot');
          src:url('/fonts/icomoon.eot?#iefix') format('embedded-opentype'),
            url('/fonts/icomoon.woff') format('woff'),
            url('/fonts/icomoon.ttf') format('truetype'),
            url('/fonts/icomoon.svg#icomoon') format('svg');
          font-weight: normal;
          font-style: normal;
        }
    </style>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-21532991-3', 'auto');
      ga('require', 'displayfeatures');
      ga('send', 'pageview');
    </script>
</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!-- <a class="navbar&#45;brand" href="/">Coldflake Blog</a> -->
            <a class="navbar-brand" rel="home" href="/" title="home">
              <img style="max-width:120px; margin-top: -7px;" src="/img/mountainBackgroundWhite.png">
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
                    
                
                    
                      
                  <li><a href="/about">About</a></li>
                      
                    
                
                    
                
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                  <li><a href="/tag">Tags</a></li>
                      
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/blackbird.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>On-The-Fly C++</h1>
                    
                    <h2 class="subheading">Using cling to interpret C++ code</h2>
                    
                    <span class="meta">Posted on August 9, 2012
                      <i class="icon-tags"></i> 
                      
                      <a href="/tag/C++">C++</a>, 
                      
                      <a href="/tag/llvm">llvm</a>, 
                      
                      <a href="/tag/clang">clang</a>
                      .
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<p>I can’t recall how many times I had to write a basic small C or C++ program just to play around with an idea, the syntax of C++11 or anything similar. Very often indeed. Even though a good editor makes this very easy, it’s kind of a burden to have to create a project directory, a source file, spell out the same old includes and the main function before you actually can start the task you where about to try.  <br />
Then you compile and link, probably missing some libraries the first time until you <strong>finally</strong> get to take it on a first test run.  </p>

<div class="jumbotron">

<h3>Building Cling</h3>

You gotta checkout <a href="http://clang.llvm.org/get_started.html">llvm and clang</a> from svn (do <em>not</em> use the git mirror!
The makefile for cling uses the svn information!). Next checkout cling from svn into the tools folder and apply all the patches in
the cling/patches directory and start your <em>configure - make - make install</em> cycle the same way you'd do for llvm and clang alone.
Don't forget to include the <em>--enable-targets=host</em> when running configure.

</div>

<p>So why put up with all of this when the next ruby or python or haskell interpreter is just a couple of keystrokes away: type <code>irb</code> or <code>ghci</code> and of you go. No includes, no compile, no linker. Just get to the meat of your idea and start experimenting. Still, would be nice to have this for C++ as well.<br />
Yesterday I discovered something truly awesome: <a href="http://root.cern.ch/drupal/content/cling">cling</a>, an interactive interpreter for the C++ language based on clang/llvm.<br />
Kind of a pain to get it set up correctly (they do not yet provide binaries for download) but once it’s done the fun can begin.</p>

<h2 id="enter-the-c-interpreter-cling">Enter the C++ interpreter: cling</h2>

<p>Now that cling is build we can run it. Best to call it with C++11 support enabled so all of the C++11 features that <a href="http://clang.llvm.org/">clang</a> provides should also work in cling:</p>

<pre class="terminal">
$ cling  -Wc++11-extensions -std=c++11

****************** CLING ******************
* Type C++ code and press enter to run it *
*             Type .q to exit             *
*******************************************
<span class="prompt">[cling]</span>$
</pre>

<p>Ready for a test run:</p>

<pre class="terminal">
<span class="prompt">[cling]</span>$ #include &lt;iostream&gt;
<span class="prompt">[cling]</span>$ using namespace std;
<span class="prompt">[cling]</span>$ int a[] = {1,2,3};
<span class="prompt">[cling]</span>$ for (int&amp; x: a){ x += 10; }
<span class="prompt">[cling]</span>$ for (int&amp; x: a){ cout &lt;&lt; x &lt;&lt; ","; }
11,12,13,
</pre>

<p>Doing calculations in C can yield some surprising results if the types are not correct. Checking small stuff in an interpreter can really help!<br />
Same thing for bit fiddling…always nice to see how it will play out.</p>

<pre class="terminal">
<span class="prompt">[cling]</span>$ float r = 7/9;
<span class="prompt">[cling]</span>$ r
(float) 0.000000e+00
<span class="prompt">[cling]</span>$ r = (float)7/9;
<span class="prompt">[cling]</span>$ r
(float) 7.777778e-01
<span class="prompt">[cling]</span>$ (0b1 &lt;&lt; 5) | 0x1
(int const) 33
</pre>

<p>Let’s use cling for more complicated math stuff. So we include the math header file:</p>

<pre class="terminal">
<span class="prompt">[cling]</span>$ #include &lt;math&gt;
input_line_36:1:10: <span style="color: #cb4b15;">fatal error:</span> 'math' file not found
#include &lt;math&gt;
      ^
</pre>

<p>Uuh…header file not found…at least the error message is nice.</p>

<pre class="terminal">
<span class="prompt">[cling]</span>$ #include &lt;cmath&gt;
<span class="prompt">[cling]</span>$ cos(7)
(double const) 7.539023e-01
</pre>

<p>Ok…that works nicely. What about using some C++11 features? Let’s try a lambda:</p>

<pre class="terminal">
<span class="prompt">[cling]</span>$ #include &lt;iostream&gt;
<span class="prompt">[cling]</span>$ using namespace std;
<span class="prompt">[cling]</span>$ auto func = [] () { cout &lt;&lt; "Hello world" &lt;&lt; endl; };
<span class="prompt">[cling]</span>$ func
(class &lt;lambda at input_line_6:2:14&gt;) @0x7f7ad79b1021
<span class="prompt">[cling]</span>$ func()
Hello world
</pre>

<p>Wow! Really impressive. Not only can you try out regular C++ bits and pieces, you can also fool around with C++11 features!<br />
It’s even possible to load and access system libraries using the <code>.L</code> load instruction. Here is a brief example of how to load the libpthread and call one of it’s functions (<code>pthread_self</code>) to retrieve the ID of the calling thread:</p>

<pre class="terminal">
<span class="prompt">[cling]</span>$ .L libpthread
<span class="prompt">[cling]</span>$ #include &lt;pthread.h&gt;
<span class="prompt">[cling]</span>$ pthread_self()
(pthread_t const) 0x7fff7da43180
</pre>

<h2 id="summary-of-metaprocessor-commands">Summary of Metaprocessor commands</h2>

<p>Cling understands some meta-commands that are not valid C++. Those commands are usefull to instruct cling to carry out certain administrative tasks, such as</p>

<ul>
  <li><code>.x test.cpp</code> – load a file (if the file defines void test() it will be executed)</li>
  <li><code>.L libname</code> – load a libary or file</li>
  <li><code>.x filename.cxx</code> – loads filename and calls void filename() if defined</li>
  <li><code>.I path</code> – adds an include path</li>
  <li><code>.printAST</code> – shows the abstract syntax tree after each processed entity</li>
  <li><code>.q</code> – exit cling</li>
  <li><code>.help</code> – display a brief description</li>
</ul>

<h2 id="worth-a-try">Worth a try</h2>

<p>I’d say cling is definitely worth the try. It’s not perfect but can be a real timesaver when fooling around with C or C++ code. Especially for little bits and pieces you want to try out while working on a C/C++ codebase, it’s much less distracting to fire up a cling interpreter than to setup an example project.</p>

<h2 id="limitations">Limitations</h2>

<p>While using cling I discovered several things that were not perfect yet:</p>

<ul>
  <li>templates seem not to be supported</li>
  <li>the <strong>auto</strong> keyword does not seem to be implicit on declarations like: <code>i=5;</code></li>
  <li>sometimes cling will segfault on small syntax errors and all current environment is lost</li>
</ul>

<pre class="terminal">
<span class="prompt">[cling]</span>$ std:string s("hi");
input_line_7:2:6: <span style="color: #cb4b15;">error:</span> unknown type name 'string'; did you mean 'std::string'?
 std:string s("hi");
     ^~~~~~
     <span style="color: #637204;">std::string</span>
/usr/include/c++/4.2.1/bits/stringfwd.h:59:33: note: 'std::string' declared here
  typedef basic_string&lt;char&gt;    string;
                                ^
Segmentation fault: 11
</pre>

<h2 id="further-information">Further Information</h2>

<p>Some interesting links people provided on <a href="http://news.ycombinator.com/item?id=4373334">hacker news</a></p>

<ul>
  <li><a href="https://docs.google.com/viewer?url=http%3A%2F%2Fwww.bitsavers.org%2Fpdf%2Fsymbolics%2Fsoftware%2Fgenera_8%2FUser_s_Guide_to_Symbolics_C.pdf">kind of an interactive C compiler</a></li>
  <li><a href="http://bellard.org/tcc/">TCC, the <em>tiny</em> C compiler</a></li>
  <li><a href="http://www.youtube.com/watch?v=f9Xfh8pv3Fs">google tech talk about cling</a></li>
  <li><a href="http://krillapps.com/coderunner/">for fooling around: coderunner</a></li>
</ul>

<p><small>Photo: NASA / Dryden Flight Research Center</small></p>


              
                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                    <a href="/posts/bash-features-of-the-year" data-toggle="tooltip" data-placement="top" title="Top 10 Unix Command Line Utilities 2011"><i class="fa fa-arrow-left"></i> Older</a>
                    </li>
                    
                    
                    <li class="next">
                    <a href="/posts/quickcheck-testing-c++" data-toggle="tooltip" data-placement="top" title="QuickChecking C++ Code">Newer <i class="fa fa-arrow-right"></i></a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                      <a href="/about" title="About">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-user fa-stack-1x fa-inverse"></i>
                            </span>
                      </a>
                    </li>
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/marcontwit">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/marcmo">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github-alt fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                      <a href="mailto:&#111;&#108;&#105;&#118;&#101;&#114;&#046;&#109;&#117;&#101;&#108;&#108;&#101;&#114;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;" title="drop me a line">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                      </a>
                    </li>
                </ul>
                <p class="copyright text-muted">Copyright &copy; Coldflake Blog 2014
                
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<script src="/js/moment.min.js "></script>
<script src="/js/livestamp.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>



</body>

</html>
