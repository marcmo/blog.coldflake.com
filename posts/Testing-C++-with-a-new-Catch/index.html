<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Exploring software technologies">

    <title>Testing C++ With A New Catch - Coldflake Blog</title>

    <link rel="canonical" href="http://blog.coldflake.com/posts/Testing-C++-with-a-new-Catch">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/coldflake.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Bitter:400,700,400italic|Ubuntu:400,500,700" rel="stylesheet" type="text/css">

    <!-- iconfonts -->
    <style type="text/css" media="screen, print">
        @font-face {
          font-family: 'icomoon';
          src:url('/fonts/icomoon.eot');
          src:url('/fonts/icomoon.eot?#iefix') format('embedded-opentype'),
            url('/fonts/icomoon.woff') format('woff'),
            url('/fonts/icomoon.ttf') format('truetype'),
            url('/fonts/icomoon.svg#icomoon') format('svg');
          font-weight: normal;
          font-style: normal;
        }
    </style>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-21532991-3', 'auto');
      ga('require', 'displayfeatures');
      ga('send', 'pageview');
    </script>
</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!-- <a class="navbar&#45;brand" href="/">Coldflake Blog</a> -->
            <a class="navbar-brand" rel="home" href="/" title="home">
              <img style="max-width:120px; margin-top: -7px;" src="/img/mountainBackgroundWhite.png">
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
                    
                
                    
                      
                  <li><a href="/about">About</a></li>
                      
                    
                
                    
                
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                    
                
                    
                      
                  <li><a href="/tag">Tags</a></li>
                      
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/catch.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Testing C++ With A New Catch</h1>
                    
                    <h2 class="subheading">Most test-frameworks are kind of lame - this one is not</h2>
                    
                    <span class="meta">Posted on December 6, 2014
                      <i class="icon-tags"></i> 
                      
                      <a href="/tag/C++">C++</a>, 
                      
                      <a href="/tag/testing">testing</a>
                      .
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<p>Unit Testing frameworks are mostly boring – if they are any good, they follow the rough approach of
the x-unit family that Kent Beck introduced with smalltalk. And in languages like ruby or even
Java they are quite comfortable and can make use of the runtime introspection capabilities, mostly
to automatically discover your test cases and execute them. Not so in C++. And the test frameworks
here always feel a little clumsy. CppUnit has an arcane way of writing and registering your
testcases. I was a user once, never again. As so often <a href="http://www.boost.org/">boost</a> has a superior solution (<a href="(http://www.boost.org/doc/libs/1_49_0/libs/test/doc/html/index.html)">Boost.Test</a>)
but it’s reeeeeeeally a pain to set it up – so I ended up not using it either.<br />
A noteworthy exception to the depressing C++ testing landscape is <a href="/posts/gtest">gtest</a>, googles own testing
framework for C++ that aims at portability and ease of use. It heavily relies on macros to provide
kind of a nice syntax and automatic test registration. It’s light weight, extensible and works on
most platforms out-of-the-box. It has become my default turn-to solution for writing C++ unit tests.
Digging into it’s features reveals that it is capable of rather non standard niceties like
repeatedly running the test cases while randomizing the execution order, running a subset of your
tests (using exclude/include patterns on invocation) or turning assertion errors directly into
debugger break-points.</p>

<h2 id="enter-the-world-of-catch">Enter the world of Catch</h2>

<p>I just found out recently about <a href="https://github.com/philsquared/Catch">Catch</a> while watching someone explain a piece of code along with it’s
tests. The first thing that kind of sticks out is that the tests seem to have a very clear visual
outline. That might seem silly but when looking at a piece of code I really like it when I can
get a feeling for the program structure merely by the outline of the text of the program. And that is
caused by one of the most intriguing aspects of <a href="https://github.com/philsquared/Catch">Catch</a>: rather then to use the classical <code>setup</code> –
<code>test</code> – <code>teardown</code> cycle, the test-cases are organized into nested sections. The inner-most
sections (the <em>leaf</em>-sections) are the actual units under test, and they are executed along with
their enclosing sections. That immediately allows to reuse setup and tear-down code – on multiple
levels.<br />
What I found is that my test cases got considerable shorter since a lot of times there is some
common setup steps or even test steps that are actually duplicated in a couple of test cases. The
classic <em>one-setup-approach</em> is just not enough here. The image shows the outline of the tests
<a href="https://github.com/marcmo/bitstream/blob/46ae519fe3abbfaa8157464fc57a26b8eeae57b2/test/BitstreamTest.cpp">before</a> and <a href="https://github.com/marcmo/bitstream/blob/b39b301ed15c05a3af81ecc8837ab12c46eead7e/test/BitstreamTest.cpp">after</a> porting them from gtest to <a href="https://github.com/philsquared/Catch">Catch</a>.</p>

<p><img class="img-responsive" src="/img/catch/code_outline.png" alt="" /></p>

<h2 id="quick-setup">Quick Setup</h2>

<p>One thing C++ programmers (or at least me) envy in the javascript/<a href="http://nodejs.org/">nodejs</a> community is the uniform
and quick way to start a project and add the dependencies. It’s quite common to check out a project
from github, do a quick <code>npm install</code> and have all dependencies installed in the local project
directory within seconds.<br />
<em>Catch</em> is a header-only library (thanks!!) and getting up to speed is just as fast: <code>wget</code> the
latest <a href="https://raw.githubusercontent.com/philsquared/Catch/master/single_include/catch.hpp">all-in-one-header</a> file, add 2 lines to your test file, and everything is ready!</p>

<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include &quot;Bitstream.h&quot;</span>
<span class="cp">#define CATCH_CONFIG_MAIN</span>
<span class="cp">#include &quot;catch.hpp&quot;</span>

<span class="n">TEST_CASE</span><span class="p">(</span><span class="s">&quot;getOneBit&quot;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">BitstreamReader</span> <span class="nf">bs</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">;</span>
    <span class="n">REQUIRE</span><span class="p">(</span><span class="mi">0</span><span class="n">b1</span> <span class="o">==</span> <span class="n">bs</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">());</span>
<span class="p">}</span></code></pre></div>

<p>No need to derive from a Test-Base class or anything like that. Pretty much just include the header,
request a predefined <code>main</code> function, and write your test-case.</p>

<h2 id="behavior-driven-anyone">Behavior Driven anyone?</h2>

<p>Quite amazingly the <em>section</em>-based design allows to use a <a href="http://en.wikipedia.org/wiki/Behavior-driven_development">BDD</a>-flavored syntax without having to
add any implementation. Here is an example of how it can be used:</p>

<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">SCENARIO</span><span class="p">(</span><span class="s">&quot;BitstreamTest: read bits from stream&quot;</span><span class="p">,</span> <span class="s">&quot;[getters]&quot;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">GIVEN</span><span class="p">(</span><span class="s">&quot;A Bitstream with 1 byte of data&quot;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">uint8_t</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="n">BitstreamReader</span><span class="o">*</span> <span class="n">bs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BitstreamReader</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">WHEN</span><span class="p">(</span><span class="s">&quot;we set the leftmost bit&quot;</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">;</span>
            <span class="n">THEN</span><span class="p">(</span><span class="s">&quot;we should get 1 when reading 1 bit&quot;</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">REQUIRE</span><span class="p">(</span><span class="mi">0</span><span class="n">b1</span> <span class="o">==</span> <span class="n">bs</span><span class="o">-&gt;</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Will produce an output something like that:</p>

<pre class="terminal">
<span class="prompt">tmp</span> &gt;
Scenario: BitstreamTest: read bits from stream
     Given: A Bitstream with 1 byte of data
      When: we set the leftmost bit
      Then: we should get 1 when reading 1 bit
    ...
</pre>

<p><code>SCENARIO</code> is merely a synonym for <code>TEST_CASE</code>, <code>GIVEN</code> and <code>WHEN</code> are synonyms for <code>SECTION</code>. So
simple but results in a beautiful DSL.</p>

<h2 id="simplicity-all-the-way">Simplicity all the way</h2>

<p>In contrast to other Unit-testing frameworks, <a href="https://github.com/philsquared/Catch">Catch</a> does not offer the usual selection of assert
macros but manages to get away with basically just 2 kinds: <code>REQUIRE</code> and <code>CHECK</code>.  <code>REQUIRE</code>
evaluates a boolean expression and stops the tests as soon as there is an assertion failure. <code>CHECK</code>
does the same thing but keeps the tests going, reporting what went wrong in the end. And the reports
you get are even really specific, not just something like the <em>”…expected True but was False…“</em>
kind of junk.</p>

<pre class="terminal">
<span class="prompt">tmp</span> &gt;
...
test/BitstreamTest.cpp:31: FAILED:
  REQUIRE( 0b1 == bs-&gt;get&lt;2&gt;() )
with expansion:
  1 == 3
...
</pre>

<h2 id="command-line-tool">Command line Tool</h2>

<p>With the executable you get a decent command line parser built in that gives you a lot of
options. Rather then to just execute every test-case, you can select the cases to be executed using
a simple glob-like pattern (e.g. <code>put*</code> matches tests starting with <code>put</code>, <code>~put*</code> everything else).<br />
Another option I really like is the <code>--list</code> option, which tells you about all available tests.
Almost a little bit like <code>rake -T</code> is used to display the available tasks in a rakefile.  <code>--tags</code>
is similar but shows the available tags instead (test-cases can be tagged with multiple strings
which makes it very convenient to restrict the executed test-cases, e.g. to just run the tests that
deal with insertion etc.).<br />
By default <a href="https://github.com/philsquared/Catch">Catch</a> is very quiet and does not report on successful test-cases. Sometimes it’s
nice to see them as well so you can use the <code>-s</code> or <code>--success</code> option to do so.<br />
There are a lot more options to explore, here are the ones of the current version:</p>

<pre class="terminal">
<span class="prompt">tmp</span> &gt; test_executable -h
Catch v1.0 build 53
usage:
  bitstream.exe [&lt;test name, pattern or tags&gt; ...] [options]

where options are:
  -?, -h, --help               display usage information
  -l, --list-tests             list all/matching test cases
  -t, --list-tags              list all/matching tags
  -s, --success                include successful tests in output
  -b, --break                  break into debugger on failure
  -e, --nothrow                skip exception tests
  -i, --invisibles             show invisibles (tabs, newlines)
  -o, --out &lt;filename&gt;         output filename
  -r, --reporter &lt;name&gt;        reporter to use (defaults to console)
  -n, --name &lt;name&gt;            suite name
  -a, --abort                  abort at first failure
  -x, --abortx &lt;no. failures&gt;  abort after x failures
  -w, --warn &lt;warning name&gt;    enable warnings
  -d, --durations &lt;yes/no&gt;     show test durations
  -f, --input-file &lt;filename&gt;  load test names to run from a file
  --list-test-names-only       list all/matching test cases names only
  --list-reporters             list all reporters
</pre>

<h2 id="give-it-a-try">Give it a Try!</h2>

<p>Catch might not be the test-framework with the most features but it certainly brings a fresh new
approach to the table. It’s trivial to setup and use and that alone should be a reason to use it.
From the limited time I spent playing with it I already found it has given me some nice benefits. I
plan to use it even more in the future.</p>



              
              <hr>
              <small>title-image by <a href="https://www.flickr.com/photos/clappstar/">clappstar</a> (<a href="https://creativecommons.org/licenses/by-nc-nd/2.0/">license</a>)</small>
              
                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                    <a href="/posts/choosing-the-Type-of-your-Types" data-toggle="tooltip" data-placement="top" title="Choosing the Type of your Types"><i class="fa fa-arrow-left"></i> Older</a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                      <a href="/about" title="About">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-user fa-stack-1x fa-inverse"></i>
                            </span>
                      </a>
                    </li>
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/marcontwit">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/marcmo">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github-alt fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                      <a href="mailto:&#111;&#108;&#105;&#118;&#101;&#114;&#046;&#109;&#117;&#101;&#108;&#108;&#101;&#114;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;" title="drop me a line">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                      </a>
                    </li>
                </ul>
                <p class="copyright text-muted">Copyright &copy; Coldflake Blog 2014
                
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<script src="/js/moment.min.js "></script>
<script src="/js/livestamp.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>



</body>

</html>
