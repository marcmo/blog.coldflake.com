
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Exploring software technologies">
    <title>Encouraging performance results - Coldflake Blog</title>
    <link rel="canonical" href="http://blog.coldflake.com/posts/cxxproject-first-results">
    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/coldflake.css">
    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Bitter:400,700,400italic|Ubuntu:400,500,700" rel="stylesheet" type="text/css">
    <!-- iconfonts -->
    <style type="text/css" media="screen, print">
        @font-face {
          font-family: 'icomoon';
          src:url('/fonts/icomoon.eot');
          src:url('/fonts/icomoon.eot?#iefix') format('embedded-opentype'),
            url('/fonts/icomoon.woff') format('woff'),
            url('/fonts/icomoon.ttf') format('truetype'),
            url('/fonts/icomoon.svg#icomoon') format('svg');
          font-weight: normal;
          font-style: normal;
        }
    </style>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-21532991-3', 'auto');
      ga('require', 'displayfeatures');
      ga('send', 'pageview');
    </script>
</head>
<body>
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!-- <a class="navbar&#45;brand" href="/">Coldflake Blog</a> -->
            <a class="navbar-brand" rel="home" href="/" title="home">
              <img style="max-width:120px; margin-top: -7px;" src="/img/mountainBackgroundWhite.png">
            </a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                  <li><a href="/about">About</a></li>
                  <li><a href="/tag">Tags</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/lights.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Encouraging performance results</h1>
                    <h2 class="subheading">First results after introducing cxxproject on a large scale, quite promising.</h2>
                    <span class="meta">Posted on December 11, 2011
                      <i class="icon-tags"></i> 
                      <a href="/tag/C++">C++</a>, 
                      <a href="/tag/ruby">ruby</a>, 
                      <a href="/tag/rake">rake</a>, 
                      <a href="/tag/performance">performance</a>, 
                      <a href="/tag/dsl">dsl</a>
                      .
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>
<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div id="tagpie">
            </div>
				<p>It has been a while since we started to implement <a href="https://github.com/marcmo/cxxproject">cxxproject</a> (early 2010) but finally we managed to adopt is as the underlying buildsystem throughout the largest projects the company I work for.<br />
I know, I know: It is foolish to build your own build system! But it’s quite a learning experience and can have it’s own <a href="/posts/2011-06-12-cxxproject.html">merits</a>. And as we now see can pay off!  </p>
<div class="jumbotron">
<h3>eclipse and CDT</h3>
The <a href="http://eclipse.org/cdt/">CDT</a> (C/C++ Development Tooling) is easily the best available open source C++ IDE available. It is well suited for companies that need a feature rich environment while at the same time want to shape and customize it for individual use cases. Thus we were able to add support for our compiler or, as just recently, completely replace the make based CDT build environment with our custom build system.
</div>
<p>Just to reiterate briefly: we were frustrated by a lot of aspects of the build-system that is normally used by the CDT: </p>
<ul>
  <li>the configuration files are an unreadable xml mess</li>
  <li>they are changed automatically on various dubious occasions so that you always get outgoing changes even if nothing should have been changed</li>
  <li>they are <em>impossible</em> to be merged!</li>
  <li>makefiles are generated on the fly, even if nothing needs to be built, which does take a long time!</li>
  <li>integrating pre- and post-steps is possible but tedious and does not consider build-dependencies correctly</li>
  <li>incompatibilities between different CDT versions</li>
  <li>…</li>
</ul>
<p>Cxxproject was the foundation that solved all of the above issues. The only problem: it’s a build tool that targets programmers. You need to hack your configuration files as an embedded ruby DSL. This approach is extremely powerful but it’s a long way from the cozy comfort of an IDE that seemingly takes care of all such aspects in the background.<br />
We now have a full integration into eclipse which provides all the IDE goodies while directly using cxxproject under the hood. Unfortunately this integration is currently not open sourced but we are working on it.<br />
Anyway…with the full IDE integration and an automatic way to convert CDT-style projects we had everything that was necessary to make the switch. Rather unexpectedly this switch was pretty smooth. And now after the first few weeks with the new build system we also gathered some interesting performance results.<br />
In the following charts we compared some daily build scenarios we have in one of our current projects. The project is a rather large software development where we build and link 207 different static libraries.<br />
The tests where conducted on a typical developer machine:</p>
<ul>
  <li>Intel Xenon (4x 2.67GHz, 4GB RAM, Windows XP, HDD Raid)</li>
  <li>eclipse 3.6 with CDT 7.0.1</li>
  <li>Ruby 1.9.2</li>
</ul>
<h3 id="build-whole-workspace">Build whole workspace</h3>
<p>Starting out with a fresh source code checkout and building all libraries and linking the final executable file turns out to be 39% faster.</p>
<p><img class="img-responsive" src="/img/cxxproject_results/buildWorkspace.png" alt="" /></p>
<h3 id="rebuild-workspace">Rebuild workspace</h3>
<p>Also interesting to compare is the speed for a rebuild. This is actually the most frequent use-case: change only a couple of files and want to rebuild and link the final executable.
Building the same workspace again without a clean in between was 73% faster!</p>
<p><img class="img-responsive" src="/img/cxxproject_results/rebuildWorkspace.png" alt="" /></p>
<h3 id="clean-everything">Clean everything</h3>
<p>Cleaning everything should be very fast. Performing a clean for all 207 projects we previously built is now 78% faster.</p>
<p><img class="img-responsive" src="/img/cxxproject_results/cleanEverything.png" alt="" /></p>
<h3 id="memory-consumption">Memory Consumption</h3>
<p>Memory consumption was also interesting to see: While the build in eclipse swelled the amount of used memory by roughly 300 MB (and stayed there!!), the cxxproject build peaked at 35 MB and released all of it after the build.
That means we use 88% less memory then a regular CDT build. Awesome!</p>
<p><img class="img-responsive" src="/img/cxxproject_results/memoryConsumption.png" alt="" /></p>
<p>We will for sure continue to tweak our build system. But the first real numbers we collected are really promising! Always nice to see an idea pays of even when it might have looked foolish at the beginning.</p>
                <hr>
                <ul class="pager">
                    <li class="previous">
                    <a href="/posts/tool-for-a-fool" data-toggle="tooltip" data-placement="top" title="A Tool for a Fool"><i class="fa fa-arrow-left"></i> Older</a>
                    </li>
                    <li class="next">
                    <a href="/posts/tumblr-no-more" data-toggle="tooltip" data-placement="top" title="Good Bye Tumblr - Welcome Hakyll">Newer <i class="fa fa-arrow-right"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</article>
<hr>
<script src="/js/d3.min.js"></script>
<script src="/js/tagpie.js"></script>
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                      <a href="/about" title="About">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-user fa-stack-1x fa-inverse"></i>
                            </span>
                      </a>
                    </li>
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/marcontwit">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/marcmo">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github-alt fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                      <a href="mailto:&#111;&#108;&#105;&#118;&#101;&#114;&#046;&#109;&#117;&#101;&#108;&#108;&#101;&#114;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;" title="drop me a line">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                      </a>
                    </li>
                </ul>
                <p class="copyright text-muted">Copyright &copy; Coldflake Blog 2014
            </div>
        </div>
    </div>
</footer>
<!-- jQuery -->
<script src="/js/jquery.min.js "></script>
<script src="/js/moment.min.js "></script>
<script src="/js/livestamp.min.js "></script>
<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>
</body>
</html>

