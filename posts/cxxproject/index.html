
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Exploring software technologies">
    <title>Building C/C++ Projects with Cxxproject - Coldflake Blog</title>
    <link rel="canonical" href="http://blog.coldflake.com/posts/cxxproject">
    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/coldflake.css">
    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Bitter:400,700,400italic|Ubuntu:400,500,700" rel="stylesheet" type="text/css">
    <!-- iconfonts -->
    <style type="text/css" media="screen, print">
        @font-face {
          font-family: 'icomoon';
          src:url('/fonts/icomoon.eot');
          src:url('/fonts/icomoon.eot?#iefix') format('embedded-opentype'),
            url('/fonts/icomoon.woff') format('woff'),
            url('/fonts/icomoon.ttf') format('truetype'),
            url('/fonts/icomoon.svg#icomoon') format('svg');
          font-weight: normal;
          font-style: normal;
        }
    </style>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-21532991-3', 'auto');
      ga('require', 'displayfeatures');
      ga('send', 'pageview');
    </script>
</head>
<body>
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!-- <a class="navbar&#45;brand" href="/">Coldflake Blog</a> -->
            <a class="navbar-brand" rel="home" href="/" title="home">
              <img style="max-width:120px; margin-top: -7px;" src="/img/mountainBackgroundWhite.png">
            </a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                  <li><a href="/about">About</a></li>
                  <li><a href="/tag">Tags</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/blue-metal-rust.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Building C/C++ Projects with Cxxproject</h1>
                    <h2 class="subheading">Intro to a Build Tool for C/C++ projects that is based on rake, the ruby task dependency DSL</h2>
                    <span class="meta">Posted on June 12, 2011
                      <i class="icon-tags"></i> 
                      <a href="/tag/C++">C++</a>, 
                      <a href="/tag/ruby">ruby</a>, 
                      <a href="/tag/rake">rake</a>, 
                      <a href="/tag/dsl">dsl</a>
                      .
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>
<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div id="tagpie">
            </div>
				<p>Why are IDE’s like <a href="http://www.eclipse.org">eclipse</a> or Visual Studio so popular with many software developers? Yes, they offer an abundance of features and support to make it bearable to program in even the most verbose languages like Java and C++. Ok, the abundance of add-ons and plugins does allow for a nice integration of additional features and customization of the work environment.</p>
<p>Another advantage for many is the ability to have managed projects. This will allow you to just create a project (let’s take C++ as an example) and will pretty much take care of setting up a build environment. Easy.</p>
<p>But this approach has some inherent drawbacks that might not be apparent at first:</p>
<ul>
  <li>you are restricted to the options that were invisioned by the IDE/plugin creators</li>
  <li>you cannot change the internal build details (build succession, priorities etc.)</li>
  <li>you might have to deal with impenetrable xml (or other “binary”) configuration files</li>
  <li>you are stuck with the toolchain your IDE offers (and thus probably with your IDE)</li>
</ul>
<p>Of course in most cases you are not bound to stick with this <em>one-size-fits-all</em> approach. Often you can use a custom makefile to describe your build.
This is by far the more flexible solution but requires you to maintain makefiles… . But makefiles are so general it might turn out to be quite challenging for non-make-gurus to setup and maintain a well structured make-based build-system.</p>
<p><img class="img-responsive" src="/img/cxxproject/cxx_buildingblocks3.png" alt="" /></p>
<p>About a year ago a <a href="http://gizmomogwai.tumblr.com">friend of mine</a> was working on a quite large C++ project that was built using Visual Studio. Since he is mostly working Mac and Linux he wanted to port the build system to s.th. less platform-dependent. That turned out to be quite a challenge and he ended up with a collection of rakefiles that he could now use on every platform.</p>
<p><a href="http://rake.rubyforge.org">Rake</a> is the ruby version of make and once you tried it you will love it. Since I was doing a lot of rake at the time and also quite often wrote rakefiles for my C/C++ projects we joined in the quest to find a suitable solution for this reoccurring task.
This was our wishlist for such a build system:</p>
<ul>
  <li>command-line tool</li>
  <li>platform independent</li>
  <li>easy to set up and maintain a build-configuration for C/C++ projects</li>
  <li>support for scripting</li>
  <li>fast builds</li>
  <li>tool for programmers</li>
</ul>
<p>We created an initial version of <em><a href="http://marcmo.github.com/cxxproject/index.html">a build-system targeted towards C/C++ projects</a></em>. The result was quite usable but not very polished. It was based on rake and used ruby as a scripting language.
…and it worked quite well! I ended up doing all my C++ projects with this and even bigger projects where quite easy to set up.</p>
<p>The basic idea is that you have <em>building blocks</em> that depend on each other. Take an executable as an example: in order to build an executable, you might need several libraries the executable links to.</p>
<p><img class="img-responsive" src="/img/cxxproject/cxx_buildingblocks1.png" alt="" /></p>
<p>The executable itself needs to be modeled as a building block that depends on several library-building blocks. Of course this view is rather simplistic since the executable will also depend on some source files and header files that themselves will depend on header files a.s.o. In order to describe a build scenario those dependencies need to be captured so that they can be transformed into a precise succession of build instructions.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">exe</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
  <span class="ss">:dependencies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;libA&#39;</span><span class="p">,</span> <span class="s1">&#39;libB&#39;</span><span class="p">,</span> <span class="s1">&#39;libC&#39;</span><span class="o">]</span></code></pre></div>
<p>You kind a get the idea. This is a sample of what a building block description looks like…and it’s vanilla ruby code. Valid ruby code can easily be included. Say we want to add all source files that reside in any subdirectory to our building block description. A <code>FileList</code> is just what we can use here:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">exe</span> <span class="s2">&quot;basic&quot;</span><span class="p">,</span>
  <span class="ss">:sources</span> <span class="o">=&gt;</span> <span class="no">FileList</span><span class="o">[</span><span class="s1">&#39;**/*.cpp&#39;</span><span class="o">]</span><span class="p">,</span>
  <span class="ss">:dependencies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;libA&#39;</span><span class="p">,</span> <span class="s1">&#39;libB&#39;</span><span class="p">,</span> <span class="s1">&#39;libC&#39;</span><span class="o">]</span></code></pre></div>
<p>Other building blocks can be described in a similar manner. Check out the <a href="http://marcmo.github.com/cxxproject/docs/tutorial.html">tutorial</a> to see some more complete examples.</p>
<p>Recently the project gained a lot of speed and we got some great new committers. We thought about how to improve our build-system at work (we are using eclipse and CDT). At first it was more of a case-study of what could be done with the cxxproject approach.<br />
After some experiments and some tuning (introducing multi-threaded builds a la <code>make -j</code>) we where able to build even huge projects (we are talking about building and linking more than 100 libraries) in a very efficient manner.</p>
<p>Working with this much bigger use-case we introduced a lot of little but nice improvements, e.g.:</p>
<ul>
  <li>optional multi-threaded builds</li>
  <li>command line progress bar</li>
  <li>live-visualization of the build graph</li>
  <li>support for including make-files as steps</li>
  <li>support for custom building blocks</li>
</ul>
<p>Currently we only support 3 different compiler-toolchains but more will follow:</p>
<ul>
  <li>gcc</li>
  <li>clang</li>
  <li>diab</li>
</ul>
<p>More features are on our road map. But the goal will always be to maintain a very <strong>simplistic</strong> system to configure C/C++ builds and do that well. We will soon see how this plays out when we get some more experience on bigger projects.</p>
                <hr>
                <ul class="pager">
                    <li class="next">
                    <a href="/posts/gtest" data-toggle="tooltip" data-placement="top" title="Testing is fun again">Newer <i class="fa fa-arrow-right"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</article>
<hr>
<script src="/js/d3.min.js"></script>
<script src="/js/tagpie.js"></script>
<script>
  render("tag_ratio.json","#tagpie", 600, 200);
</script>
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                      <a href="/about" title="About">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-user fa-stack-1x fa-inverse"></i>
                            </span>
                      </a>
                    </li>
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://twitter.com/marcontwit">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/marcmo">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github-alt fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                      <a href="mailto:&#111;&#108;&#105;&#118;&#101;&#114;&#046;&#109;&#117;&#101;&#108;&#108;&#101;&#114;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;" title="drop me a line">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                      </a>
                    </li>
                </ul>
                <p class="copyright text-muted">Copyright &copy; Coldflake Blog 2014
            </div>
        </div>
    </div>
</footer>
<!-- jQuery -->
<script src="/js/jquery.min.js "></script>
<script src="/js/jquery.timeago.js "></script>
<script>
jQuery(document).ready(function() {
  jQuery("span.timeago").timeago();
});
</script>
<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>
</body>
</html>

